<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choices: A Narrative Journey</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 700px;
            width: 100%;
            padding: 40px;
            margin: 20px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 0.95em;
        }

        select, input[type="range"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            background: white;
            transition: border-color 0.3s;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.85em;
            color: #666;
        }

        .range-value {
            text-align: center;
            margin-top: 5px;
            font-weight: 600;
            color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .story-content {
            display: none;
        }

        .story-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #333;
            margin-bottom: 30px;
            min-height: 150px;
        }

        .choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .choice-btn {
            background: #f5f5f5;
            color: #333;
            text-align: left;
            padding: 16px;
            border: 2px solid #e0e0e0;
            transition: all 0.2s;
        }

        .choice-btn:hover {
            background: #e8e8e8;
            border-color: #667eea;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            width: 0%;
        }

        .restart-btn {
            background: #666;
            margin-top: 20px;
        }

        .restart-btn:hover {
            background: #555;
        }

        .summary {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            margin-top: 20px;
        }

        .summary h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .summary p {
            line-height: 1.8;
            color: #555;
            margin-bottom: 10px;
        }

        @media (max-width: 600px) {
            .container {
                padding: 25px;
            }

            h1 {
                font-size: 1.5em;
            }

            .story-text {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Choices: A Narrative Journey</h1>
        <p class="subtitle">Explore how personal choices are shaped by social forces</p>
        
        <!-- Professor Greeting -->
        <div style="text-align: center; color: #333; font-size: 1em; margin-bottom: 30px; padding: 20px; background: linear-gradient(135deg, #f0f4ff 0%, #e8edff 100%); border-radius: 10px; border: 2px solid #667eea; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);">
            <p style="font-weight: 700; margin-bottom: 12px; font-size: 1.3em; color: #667eea;">Hi Professor! ðŸ‘‹</p>
            <p style="line-height: 1.7; margin-bottom: 10px; font-weight: 500;">This is my final project for <strong>01:988:101 - Introduction to Gender, Race, and Sexuality</strong>.</p>
            <p style="line-height: 1.7; margin-bottom: 12px;">I've created an interactive narrative game that explores how personal choices around sexuality and identity are shaped by gender, cultural background, and family expectations. The story adapts based on the player's selections, demonstrating how structural forcesâ€”rather than pure individual agencyâ€”constrain and shape what we perceive as "personal choices." Each playthrough reveals different intersections of constraint and possibility, highlighting how privilege and oppression operate through these categories of difference.</p>
            <p style="margin-top: 12px; font-size: 0.95em; color: #555; font-style: italic; font-weight: 500;">â€” Shaheer Saud</p>
        </div>

        <!-- Character Selection Form -->
        <div id="character-selection">
            <div class="form-group">
                <label for="gender">Gender Identity:</label>
                <select id="gender">
                    <option value="man">Man</option>
                    <option value="woman">Woman</option>
                    <option value="non-binary">Non-Binary</option>
                </select>
            </div>

            <div class="form-group">
                <label for="culture">Cultural Background:</label>
                <select id="culture">
                    <option value="conservative">Conservative Religious</option>
                    <option value="moderate">Moderate Traditional</option>
                    <option value="liberal">Liberal Secular</option>
                </select>
            </div>

            <div class="form-group">
                <label for="family-expectation">Family Expectation Level:</label>
                <input type="range" id="family-expectation" min="1" max="3" value="2">
                <div class="range-labels">
                    <span>Low</span>
                    <span>Medium</span>
                    <span>High</span>
                </div>
                <div class="range-value" id="expectation-value">Medium</div>
            </div>

            <button onclick="startStory()">Begin Your Journey</button>
        </div>

        <!-- Story Content -->
        <div id="story-content" class="story-content">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="story-text" id="story-text"></div>
            <div class="choices" id="choices"></div>
            <button class="restart-btn" onclick="restart()">Restart</button>
        </div>
    </div>

    <script>
        // Game state object - stores player choices and current story node
        let gameState = {
            gender: null,
            culture: null,
            familyExpectation: null,
            currentNode: 0,
            path: []
        };

        // Story nodes - each node has text and choices
        // The text and choices adapt based on player background
        const storyNodes = [
            {
                // Node 0: Introduction
                getText: (state) => {
                    const genderText = {
                        'man': 'As a man',
                        'woman': 'As a woman',
                        'non-binary': 'As a non-binary person'
                    };
                    return `${genderText[state.gender]}, you've reached a point in your life where you're questioning your identity and desires. The expectations around you feel heavy, but you're trying to understand what you truly want.`;
                },
                choices: [
                    { text: 'Explore your feelings privately', next: 1 },
                    { text: 'Talk to a close friend', next: 2 },
                    { text: 'Seek professional guidance', next: 3 }
                ]
            },
            {
                // Node 1: Private exploration
                getText: (state) => {
                    if (state.culture === 'conservative' && state.familyExpectation === 3) {
                        return 'You try to explore your feelings alone, but guilt and fear creep in. Every thought feels like a betrayal of what you were taught. The isolation makes it harder to understand yourself clearly.';
                    } else if (state.gender === 'woman' && state.culture === 'conservative') {
                        return 'As a woman in a conservative environment, exploring privately feels safer, but also lonely. You wonder if your feelings are valid or just confusion. The silence around these topics makes it hard to find clarity.';
                    } else {
                        return 'You spend time reflecting on your feelings. It\'s confusing but also freeing to have this space. However, you realize you might need support to truly understand yourself.';
                    }
                },
                choices: [
                    { text: 'Continue exploring alone', next: 4 },
                    { text: 'Reach out to someone', next: 2 }
                ]
            },
            {
                // Node 2: Talking to a friend
                getText: (state) => {
                    if (state.gender === 'man' && state.culture === 'conservative') {
                        return 'You confide in a friend. They listen, but you notice their discomfort. "Are you sure?" they ask. "Maybe it\'s just a phase." Their reaction makes you question yourself more than before.';
                    } else if (state.familyExpectation === 3) {
                        return 'Your friend is supportive, but warns you: "Be careful who you tell. Your family might not understand." The weight of potential consequences hangs over your conversation.';
                    } else {
                        return 'Your friend listens with empathy. They don\'t have all the answers, but having someone to talk to helps. You feel less alone in your journey.';
                    }
                },
                choices: [
                    { text: 'Ask them to keep it secret', next: 5 },
                    { text: 'Feel encouraged to explore more', next: 6 }
                ]
            },
            {
                // Node 3: Professional guidance
                getText: (state) => {
                    if (state.culture === 'conservative' && state.familyExpectation >= 2) {
                        return 'You find a therapist, but worry about your family finding out. The sessions help, but you\'re constantly aware of the cultural and religious teachings that conflict with what you\'re discovering about yourself.';
                    } else if (state.gender === 'non-binary') {
                        return 'Finding a therapist who understands non-binary experiences is challenging. Some try to fit you into binary categories. You realize how much society\'s structures shape even professional help.';
                    } else {
                        return 'Therapy provides a safe space to explore. Your therapist helps you understand that your feelings are valid, regardless of external expectations.';
                    }
                },
                choices: [
                    { text: 'Continue therapy', next: 7 },
                    { text: 'Try a different approach', next: 1 }
                ]
            },
            {
                // Node 4: Continued isolation
                getText: (state) => {
                    if (state.gender === 'woman' && state.culture === 'conservative') {
                        return 'The isolation deepens. As a woman, you\'ve been taught that your desires should be secondary to family honor. Every thought feels like a secret rebellion. You wonder if you\'ll ever be able to be yourself.';
                    } else if (state.familyExpectation === 3) {
                        return 'Alone with your thoughts, the pressure builds. You realize how much your family\'s expectations have shaped what you thought were "your" choices. The line between who you are and who you\'re supposed to be blurs.';
                    } else {
                        return 'Time alone helps, but you start to see how your background has limited your understanding of what\'s possible. You realize you need community to truly explore your identity.';
                    }
                },
                choices: [
                    { text: 'Join an online community', next: 8 },
                    { text: 'Keep struggling alone', next: 9 }
                ]
            },
            {
                // Node 5: Keeping secrets
                getText: (state) => {
                    if (state.culture === 'conservative') {
                        return 'You ask your friend to keep it secret. They agree, but you both know the stakes. In your community, being discovered could mean social ostracization, family conflict, or worse. The secrecy becomes another burden.';
                    } else if (state.familyExpectation >= 2) {
                        return 'The secrecy feels necessary but also painful. You realize how much your choices are constrained by fear of disappointing your family. Is this really a "choice" when the consequences are so severe?';
                    } else {
                        return 'Keeping it secret feels safer for now, but you wonder how long you can live this way. The weight of hiding part of yourself grows heavier.';
                    }
                },
                choices: [
                    { text: 'Decide to come out to family', next: 10 },
                    { text: 'Continue living in secret', next: 9 }
                ]
            },
            {
                // Node 6: Feeling encouraged
                getText: (state) => {
                    if (state.gender === 'man' && state.culture === 'moderate') {
                        return 'Feeling encouraged, you start exploring more openly. However, you notice subtle reactions - people treating you differently, assumptions about your masculinity. The social costs become clearer.';
                    } else if (state.culture === 'liberal') {
                        return 'With support, you feel more free to explore. Your environment is more accepting, and you realize how much privilege this represents. Not everyone has this space.';
                    } else {
                        return 'The encouragement helps, but you\'re still navigating a world that wasn\'t built for people like you. Every step forward requires courage.';
                    }
                },
                choices: [
                    { text: 'Attend a support group', next: 8 },
                    { text: 'Start dating', next: 11 }
                ]
            },
            {
                // Node 7: Continuing therapy
                getText: (state) => {
                    if (state.gender === 'woman' && state.familyExpectation === 3) {
                        return 'Therapy helps, but you\'re torn. As a woman with high family expectations, you\'re supposed to marry, have children, maintain the family\'s honor. Your authentic self conflicts with these roles. The therapist validates your feelings, but can\'t change your reality.';
                    } else if (state.culture === 'conservative') {
                        return 'Therapy reveals how deeply cultural and religious teachings have shaped your self-perception. You begin to separate what you\'ve been taught from what you actually feel. It\'s painful but liberating.';
                    } else {
                        return 'Therapy provides tools to navigate your journey. You learn that your identity is valid, and that you have the right to explore and define yourself.';
                    }
                },
                choices: [
                    { text: 'Make a decision about your identity', next: 12 },
                    { text: 'Take more time to explore', next: 6 }
                ]
            },
            {
                // Node 8: Online community
                getText: (state) => {
                    if (state.culture === 'conservative') {
                        return 'You find an online community, but you use a pseudonym. Even in digital spaces, you can\'t fully be yourself because of the risk of being discovered. The anonymity helps, but also highlights how constrained your life has become.';
                    } else if (state.gender === 'non-binary') {
                        return 'Connecting with others who share your experience is transformative. You realize you\'re not alone, and that your identity is valid. However, you also see how much harder it is for non-binary people in a binary world.';
                    } else {
                        return 'The community provides support and understanding. You see how different people navigate similar challenges, and realize how much your background has shaped your options.';
                    }
                },
                choices: [
                    { text: 'Become more active in the community', next: 13 },
                    { text: 'Use this support to make life changes', next: 12 }
                ]
            },
            {
                // Node 9: Struggling alone
                getText: (state) => {
                    if (state.familyExpectation === 3) {
                        return 'The struggle continues. You realize that "choosing" to hide is not really a choice when the alternative means losing your family, your community, your entire support system. The weight of expectations crushes your sense of agency.';
                    } else if (state.gender === 'woman' && state.culture === 'conservative') {
                        return 'Alone, you grapple with the conflict between your desires and your role as a woman in your community. You\'re supposed to be pure, modest, and focused on family. Your authentic self doesn\'t fit this mold, and the isolation is crushing.';
                    } else {
                        return 'The isolation takes its toll. You realize that personal choice is never truly personal - it\'s always shaped by what\'s acceptable, what\'s safe, what\'s possible in your context.';
                    }
                },
                choices: [
                    { text: 'Reach a breaking point', next: 10 },
                    { text: 'Continue living inauthentically', next: 14 }
                ]
            },
            {
                // Node 10: Coming out decision
                getText: (state) => {
                    if (state.culture === 'conservative' && state.familyExpectation === 3) {
                        return 'You decide to come out to your family. The reaction is devastating. They see it as a betrayal, a rejection of everything they taught you. You\'re told you\'re choosing to sin, to dishonor the family. The "choice" to be yourself comes at an enormous cost.';
                    } else if (state.familyExpectation >= 2) {
                        return 'Coming out creates tension. Some family members are accepting, others are not. You realize that your "choice" to be authentic required you to risk relationships that were supposed to be unconditional. The burden of this "choice" weighs heavily.';
                    } else {
                        return 'You come out, and while there\'s some discomfort, your family tries to understand. You realize how much easier this is for you than for others in more restrictive environments.';
                    }
                },
                choices: [
                    { text: 'Continue forward', next: 15 }
                ]
            },
            {
                // Node 11: Starting to date
                getText: (state) => {
                    if (state.gender === 'man' && state.culture === 'conservative') {
                        return 'You start dating, but you have to be extremely careful. In your community, being discovered could mean violence or complete social exclusion. Every date feels risky. Your "choice" to date is constrained by fear.';
                    } else if (state.gender === 'woman' && state.culture === 'moderate') {
                        return 'Dating as a woman in a moderate traditional environment means navigating expectations about modesty, honor, and appropriate behavior. Your choices are constantly judged and constrained.';
                    } else {
                        return 'Dating opens new possibilities, but you also see how your background has shaped your understanding of relationships and intimacy.';
                    }
                },
                choices: [
                    { text: 'Continue exploring relationships', next: 13 },
                    { text: 'Reflect on what you\'ve learned', next: 15 }
                ]
            },
            {
                // Node 12: Making a decision
                getText: (state) => {
                    if (state.culture === 'conservative') {
                        return 'You make a decision about your identity, but you realize it\'s not really a "choice" in the way people think. Your options were limited from the start by your culture, religion, and family. What looks like personal freedom is actually navigating within severe constraints.';
                    } else if (state.gender === 'non-binary') {
                        return 'You embrace your non-binary identity, but you see how the world isn\'t built for you. Every form, every space, every interaction assumes binary gender. Your "choice" to be yourself requires constant explanation and justification.';
                    } else {
                        return 'You make decisions about your identity, but you\'re aware of how much easier this journey has been because of your background. You see the privilege in having more options.';
                    }
                },
                choices: [
                    { text: 'Reflect on the journey', next: 15 }
                ]
            },
            {
                // Node 13: Active in community
                getText: (state) => {
                    if (state.culture === 'conservative') {
                        return 'You become more active, but always with caution. You see others who\'ve lost everything for being authentic. The community becomes your chosen family, but you also see how society has forced this choice upon you.';
                    } else {
                        return 'Being active in the community helps you understand the broader social forces at play. You see how gender, culture, and family expectations shape everyone\'s journey differently.';
                    }
                },
                choices: [
                    { text: 'Continue your journey', next: 15 }
                ]
            },
            {
                // Node 14: Living inauthentically
                getText: (state) => {
                    if (state.familyExpectation === 3) {
                        return 'You continue living inauthentically, conforming to expectations. Years pass. You marry someone you don\'t love, live a life that isn\'t yours. The "choice" to conform wasn\'t really a choice - it was survival. The cost of being yourself was too high.';
                    } else {
                        return 'You continue hiding, but the weight grows. You realize that choosing to hide isn\'t really choosing - it\'s being forced into a box by social expectations.';
                    }
                },
                choices: [
                    { text: 'Reach the end', next: 15 }
                ]
            },
            {
                // Node 15: Ending/Reflection - Different endings based on background
                getText: (state) => {
                    // Different endings based on combinations of gender, culture, and family expectation
                    if (state.culture === 'conservative' && state.familyExpectation === 3) {
                        if (state.gender === 'woman') {
                            return 'Years have passed. You look back on your journey and realize how deeply your choices were constrained. As a woman in a conservative religious environment with high family expectations, the "choices" you made were often the only safe options available. The cost of authenticity was too highâ€”family rejection, social ostracization, loss of community. You see now that what appeared to be personal decisions were actually survival strategies shaped by forces beyond your control.';
                        } else if (state.gender === 'man') {
                            return 'Looking back, you see how your identity as a man in a conservative religious community with high family expectations created a narrow path. The pressure to conform, to maintain honor, to fulfill masculine rolesâ€”these weren\'t choices you made freely. They were expectations you navigated, often at the cost of your authentic self. The structures around you determined what was possible.';
                        } else {
                            return 'Your journey as a non-binary person in a conservative religious environment with high family expectations has been particularly challenging. The binary structures of your culture and religion left little room for your identity. Every "choice" was actually a negotiation between authenticity and safety, between being yourself and maintaining relationships. You realize how much privilege others have in having their identity recognized.';
                        }
                    } else if (state.culture === 'conservative' && state.familyExpectation === 2) {
                        if (state.gender === 'woman') {
                            return 'Reflecting on your path, you see how being a woman in a conservative environment with moderate family expectations created a complex landscape. You had some room to explore, but always within boundaries. The fear of judgment, the weight of cultural expectations, the pressure to maintain modesty and honorâ€”these shaped every decision. Your "choices" were made within a framework you didn\'t create.';
                        } else {
                            return 'Your journey reveals the subtle ways conservative culture and moderate family expectations constrained your options. You had more freedom than some, but still navigated a world where certain identities and expressions were unacceptable. The choices you made were always calculated against potential consequences.';
                        }
                    } else if (state.culture === 'moderate' && state.familyExpectation >= 2) {
                        if (state.gender === 'non-binary') {
                            return 'As a non-binary person navigating moderate traditional culture with significant family expectations, you\'ve experienced the constant work of explaining and justifying your identity. The world assumes binary gender, and every interaction requires you to navigate that assumption. Your "choices" about how to present yourself, who to tell, how to liveâ€”all shaped by a society that doesn\'t recognize you.';
                        } else {
                            return 'Your moderate traditional background with significant family expectations created a middle groundâ€”not as restrictive as conservative environments, but still bound by tradition. You had more options than some, but every choice carried the weight of family judgment and cultural norms. The freedom to choose was always conditional.';
                        }
                    } else if (state.culture === 'liberal') {
                        if (state.gender === 'non-binary') {
                            return 'Even in a liberal secular environment, your journey as a non-binary person has revealed structural barriers. While you faced less explicit discrimination, you still navigated a world built for binary genderâ€”forms, spaces, language, expectations. Your "choices" were easier than for others, but you recognize the privilege and the work still needed for true inclusion.';
                        } else if (state.familyExpectation === 1) {
                            return 'Your liberal secular background with low family expectations gave you more freedom than many. You recognize this privilegeâ€”the ability to explore your identity without fear of severe consequences. But even here, you\'ve seen how gender norms, social expectations, and cultural assumptions shaped your understanding of what was possible. True freedom requires recognizing these invisible constraints.';
                        } else {
                            return 'Even in a more accepting environment, family expectations and gender norms still shaped your journey. You had more options than those in restrictive environments, but you see how your choices were still influenced by social structures, media representations, and cultural assumptions about identity and relationships.';
                        }
                    } else {
                        // Low family expectation, moderate/liberal culture
                        if (state.gender === 'woman') {
                            return 'As a woman with lower family expectations in a more accepting environment, you\'ve had more space to explore. But you\'ve still encountered gender-based assumptions, double standards, and expectations about femininity, relationships, and sexuality. Your "choices" were freer, but still shaped by gendered social structures.';
                        } else {
                            return 'Your journey with lower family expectations in a more accepting environment has been easier than many. You recognize this privilege while also seeing how social structuresâ€”gender norms, cultural assumptions, media representationsâ€”still shaped your understanding of identity and possibility.';
                        }
                    }
                },
                choices: []
            }
        ];

        // Update range value display
        document.getElementById('family-expectation').addEventListener('input', function(e) {
            const value = parseInt(e.target.value);
            const labels = ['Low', 'Medium', 'High'];
            document.getElementById('expectation-value').textContent = labels[value - 1];
        });

        // Start the story after character selection
        function startStory() {
            // Get selected values
            gameState.gender = document.getElementById('gender').value;
            gameState.culture = document.getElementById('culture').value;
            gameState.familyExpectation = parseInt(document.getElementById('family-expectation').value);
            gameState.currentNode = 0;
            gameState.path = [];

            // Hide character selection, show story
            document.getElementById('character-selection').style.display = 'none';
            document.getElementById('story-content').style.display = 'block';

            // Render first node
            renderNode(0);
        }

        // Render a story node based on current state
        function renderNode(nodeIndex) {
            gameState.currentNode = nodeIndex;
            gameState.path.push(nodeIndex);

            const node = storyNodes[nodeIndex];
            
            // Get dynamic text based on player background
            const storyText = node.getText(gameState);
            document.getElementById('story-text').textContent = storyText;

            // Clear previous choices
            const choicesContainer = document.getElementById('choices');
            choicesContainer.innerHTML = '';

            // If this is the end node, show summary
            if (nodeIndex === 15) {
                showSummary();
                return;
            }

            // Render choices
            node.choices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.textContent = choice.text;
                button.onclick = () => makeChoice(choice.next);
                choicesContainer.appendChild(button);
            });

            // Update progress bar (15 nodes total, 0-14 + ending)
            const progress = ((nodeIndex + 1) / 16) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
        }

        // Handle player choice
        function makeChoice(nextNode) {
            renderNode(nextNode);
        }

        // Show reflective summary at the end - personalized based on selections
        function showSummary() {
            const choicesContainer = document.getElementById('choices');
            choicesContainer.innerHTML = '';

            const summary = document.createElement('div');
            summary.className = 'summary';
            
            const genderText = {
                'man': 'man',
                'woman': 'woman',
                'non-binary': 'non-binary person'
            };
            
            const cultureText = {
                'conservative': 'conservative religious',
                'moderate': 'moderate traditional',
                'liberal': 'liberal secular'
            };
            
            const expectationText = ['low', 'medium', 'high'];
            
            // Generate personalized summary based on specific combinations
            let genderImpact = '';
            let cultureImpact = '';
            let expectationImpact = '';
            let finalReflection = '';
            
            // Gender-specific impacts
            if (gameState.gender === 'woman') {
                if (gameState.culture === 'conservative') {
                    genderImpact = `As a woman in a conservative religious environment, you faced specific constraints around modesty, purity, and honor. Your gender meant that your choices were constantly judged against standards of femininity and family honor. The risks you facedâ€”social ostracization, family rejection, violenceâ€”were gendered. Your identity as a woman fundamentally shaped what was considered acceptable and what carried severe consequences.`;
                } else {
                    genderImpact = `As a woman, you navigated gendered expectations about relationships, sexuality, and identity. Even in more accepting environments, you encountered double standards, assumptions about femininity, and expectations about your role. Your gender identity shaped how others perceived your choices and what risks you could safely take.`;
                }
            } else if (gameState.gender === 'man') {
                if (gameState.culture === 'conservative') {
                    genderImpact = `As a man in a conservative religious environment, you faced expectations around masculinity, honor, and leadership. Your gender meant that certain expressions of identity were seen as threats to your masculinity. The pressure to conform to masculine roles and maintain family honor shaped every decision. Your identity as a man created specific constraints around what you could explore safely.`;
                } else {
                    genderImpact = `As a man, you navigated expectations around masculinity and strength. Even in more accepting environments, you encountered assumptions about what men should be, how they should express themselves, and what relationships are appropriate. Your gender identity shaped the social costs of your choices.`;
                }
            } else {
                genderImpact = `As a non-binary person, you navigated a world built for binary gender. Every form, every space, every interaction assumed you were either a man or a woman. Your identity required constant explanation and justification. The structures around youâ€”language, institutions, social normsâ€”didn't recognize you, making every "choice" about identity an act of resistance against systems that erase you.`;
            }
            
            // Culture-specific impacts
            if (gameState.culture === 'conservative') {
                cultureImpact = `Your conservative religious background created a framework where certain identities and expressions were not just discouraged, but considered sinful or dishonorable. Religious teachings, cultural norms, and community values didn't just influence youâ€”they fundamentally limited what you could safely explore. The threat of religious condemnation, community exclusion, and family shame shaped every decision. Your "choices" were made within boundaries defined by faith and tradition.`;
            } else if (gameState.culture === 'moderate') {
                cultureImpact = `Your moderate traditional background created a middle groundâ€”more flexible than conservative environments, but still bound by tradition and cultural expectations. You had more room to explore, but always within certain boundaries. Cultural norms about appropriate behavior, relationships, and identity still shaped your understanding of what was possible. Your choices were freer, but still constrained by tradition.`;
            } else {
                cultureImpact = `Your liberal secular background provided more acceptance and fewer explicit restrictions. However, even here, cultural assumptions, media representations, and social norms shaped your understanding of identity and relationships. You had more privilege than those in restrictive environments, but you still navigated structures that assumed certain norms about gender, sexuality, and identity.`;
            }
            
            // Family expectation impacts
            if (gameState.familyExpectation === 3) {
                expectationImpact = `With high family expectations, every choice carried the weight of potential family rejection, disappointment, or loss. The "freedom" to choose was always conditionalâ€”you could be yourself, but at the cost of relationships that were supposed to be unconditional. Family honor, tradition, and expectations created consequences that made authenticity feel like betrayal. Your choices were survival strategies, not free expressions of self.`;
            } else if (gameState.familyExpectation === 2) {
                expectationImpact = `With medium family expectations, you navigated a complex landscape. You had some room to explore, but always aware of potential family judgment or disappointment. The fear of letting down your family, of breaking tradition, of causing conflict shaped your decisions. Your choices were made with family consequences in mind, limiting your sense of freedom.`;
            } else {
                expectationImpact = `With low family expectations, you had more freedom than many. Your family's acceptance or at least tolerance gave you space to explore. However, you still navigated social expectations, cultural norms, and structural barriers. Even with family support, the broader social structures around gender, culture, and identity shaped your options and understanding.`;
            }
            
            // Analyze the path taken to personalize the journey reflection
            let pathAnalysis = '';
            const path = gameState.path;
            
            // Check which key decisions were made
            const exploredAlone = path.includes(1) || path.includes(4);
            const talkedToFriend = path.includes(2) || path.includes(5);
            const soughtTherapy = path.includes(3) || path.includes(7);
            const keptSecrets = path.includes(5) || path.includes(9);
            const cameOut = path.includes(10);
            const joinedCommunity = path.includes(8) || path.includes(13);
            const livedInauthentically = path.includes(14);
            
            if (exploredAlone && keptSecrets && !cameOut) {
                pathAnalysis = `Your journey took you through isolation and secrecy. You chose to explore privately and keep your identity hidden, which reveals how the fear of consequencesâ€”shaped by your ${cultureText[gameState.culture]} background and ${expectationText[gameState.familyExpectation - 1]} family expectationsâ€”led you to choose safety over authenticity. This wasn't a free choice; it was a survival strategy.`;
            } else if (soughtTherapy && cameOut) {
                pathAnalysis = `You sought professional help and ultimately chose to come out. This path shows courage, but also reveals how much support and resources matter. Your ability to access therapy and take the risk of coming out was shaped by your backgroundâ€”some have these options, others don't. Your journey highlights both individual agency and structural privilege.`;
            } else if (talkedToFriend && joinedCommunity) {
                pathAnalysis = `You found support through friends and community. This path shows the importance of chosen family and community support, but also reveals how access to accepting communities varies dramatically based on geography, culture, and social networks. Your ability to find this support was shaped by factors beyond your control.`;
            } else if (livedInauthentically) {
                pathAnalysis = `Your journey led you to continue living inauthentically, conforming to expectations. This path powerfully demonstrates how "choice" becomes meaningless when the alternative means losing everything. Your decision to conform wasn't weaknessâ€”it was a response to structural constraints that made authenticity too costly.`;
            } else if (exploredAlone && !soughtTherapy) {
                pathAnalysis = `You navigated this journey largely alone, without professional support. This path reveals how access to resourcesâ€”therapy, support groups, safe spacesâ€”is not equally available to everyone. Your gender, culture, and family background shaped not just your choices, but your access to the tools that could help you navigate them.`;
            } else {
                pathAnalysis = `Your specific path through this narrative reveals unique intersections of constraint and possibility. The choices you made were shaped by the options available to youâ€”options that were themselves determined by your gender, culture, and family expectations. Every decision point in your journey was filtered through these social structures.`;
            }
            
            // Final reflection based on combination
            if (gameState.culture === 'conservative' && gameState.familyExpectation === 3) {
                finalReflection = `Your specific combinationâ€”${genderText[gameState.gender]} in a conservative religious environment with high family expectationsâ€”created particularly severe constraints. The intersection of gender norms, religious teachings, and family pressure created a narrow path where authenticity came at enormous cost. Your journey highlights how these forces compound, making "personal choice" almost impossible.`;
            } else if (gameState.culture === 'liberal' && gameState.familyExpectation === 1) {
                finalReflection = `Your combinationâ€”${genderText[gameState.gender]} in a liberal secular environment with low family expectationsâ€”gave you more privilege than most. You had more freedom to explore, but this journey has shown you how even in accepting environments, social structures still shape identity and choice. Recognizing this privilege is crucial for understanding the struggles of those with less freedom.`;
            } else {
                finalReflection = `Your specific combination of background factors created a unique landscape of constraints and possibilities. The intersection of your gender, culture, and family expectations shaped not just your options, but your understanding of what was even possible. This reveals how personal choice is always contextual, always shaped by forces beyond individual will.`;
            }
            
            summary.innerHTML = `
                <h2>Reflection: The Illusion of Choice</h2>
                <p>As a ${genderText[gameState.gender]} from a ${cultureText[gameState.culture]} background, with ${expectationText[gameState.familyExpectation - 1]} family expectations, your journey reveals a fundamental truth: personal choice is never purely personal.</p>
                <p><strong>How Gender Shaped Your Path:</strong> ${genderImpact}</p>
                <p><strong>How Culture Constrained Your Options:</strong> ${cultureImpact}</p>
                <p><strong>How Family Expectations Created Consequences:</strong> ${expectationImpact}</p>
                <p><strong>Your Specific Journey:</strong> ${pathAnalysis}</p>
                <p><strong>What This Reveals:</strong> ${finalReflection}</p>
                <p>This narrative isn't about individual failure or success. It's about recognizing that sexuality and identity are shaped by forces beyond personal will. True freedom requires not just individual courage, but social changeâ€”challenging the structures that make authenticity a privilege rather than a right.</p>
            `;
            
            document.getElementById('story-text').parentNode.insertBefore(summary, document.getElementById('story-text').nextSibling);
            
            // Update progress to 100%
            document.getElementById('progress-fill').style.width = '100%';
        }

        // Restart the game
        function restart() {
            gameState = {
                gender: null,
                culture: null,
                familyExpectation: null,
                currentNode: 0,
                path: []
            };

            document.getElementById('character-selection').style.display = 'block';
            document.getElementById('story-content').style.display = 'none';
            document.getElementById('story-text').textContent = '';
            document.getElementById('choices').innerHTML = '';
            document.getElementById('progress-fill').style.width = '0%';
            
            // Remove summary if it exists
            const summary = document.querySelector('.summary');
            if (summary) {
                summary.remove();
            }
        }
    </script>
</body>
</html>

